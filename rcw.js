!function(){"use strict";class e{constructor(e,t,s){this.value="",this.side=-1,this.face=-1,this.value=e,this.side=t,this.face=s}toString(){return this.value}}class t{constructor(){this.sides=[],this.sideOrder="ULFRBD",this.axis="MES",this.adjacentFaces={U:["F2","F1","F0","L2","L1","L0","B2","B1","B0","R2","R1","R0"],L:["F0","F3","F6","D0","D3","D6","B8","B5","B2","U0","U3","U6"],F:["U6","U7","U8","R0","R3","R6","D2","D1","D0","L8","L5","L2"],R:["U8","U5","U2","B0","B3","B6","D8","D5","D2","F8","F5","F2"],B:["U2","U1","U0","L0","L3","L6","D6","D7","D8","R8","R5","R2"],D:["F6","F7","F8","R6","R7","R8","B6","B7","B8","L6","L7","L8"]},this.sides=[];for(let t=0;t<6;t++)for(let s=0;s<9;s++)this.sides[t]=new Array(9).fill(new e(this.sideOrder[t],t,s))}get(e){let{side:t,face:s}=this.getSideFace(e);return this.sides[t][s]}getFace(e,t){return this.sides[e][t]}set(e,t){let{side:s,face:i}=this.getSideFace(e);this.sides[s][i]=t}getSideFace(e){if(2!==e.length)throw new Error("Invalid index "+e);e=e.toUpperCase();let t={side:this.sideOrder.indexOf(e[0]),face:parseInt(e[1])};if(t.side<0||t.face<0||t.face>8||isNaN(t.face))throw new Error("Index "+e+" is out of bounds");return t}toString(e=""){return this.sides.map((e=>e.map((e=>e.value)).join(""))).join(e)}pretty(){return`         +–––––––+\n         | ${this.sides[0][0]} ${this.sides[0][1]} ${this.sides[0][2]} |\n         | ${this.sides[0][3]} ${this.sides[0][4]} ${this.sides[0][5]} |\n         | ${this.sides[0][6]} ${this.sides[0][7]} ${this.sides[0][8]} |\n +–––––––+–––––––+–––––––+–––––––+\n | ${this.sides[1][0]} ${this.sides[1][1]} ${this.sides[1][2]} | ${this.sides[2][0]} ${this.sides[2][1]} ${this.sides[2][2]} | ${this.sides[3][0]} ${this.sides[3][1]} ${this.sides[3][2]} | ${this.sides[4][0]} ${this.sides[4][1]} ${this.sides[4][2]} |\n | ${this.sides[1][3]} ${this.sides[1][4]} ${this.sides[1][5]} | ${this.sides[2][3]} ${this.sides[2][4]} ${this.sides[2][5]} | ${this.sides[3][3]} ${this.sides[3][4]} ${this.sides[3][5]} | ${this.sides[4][3]} ${this.sides[4][4]} ${this.sides[4][5]} |\n | ${this.sides[1][6]} ${this.sides[1][7]} ${this.sides[1][8]} | ${this.sides[2][6]} ${this.sides[2][7]} ${this.sides[2][8]} | ${this.sides[3][6]} ${this.sides[3][7]} ${this.sides[3][8]} | ${this.sides[4][6]} ${this.sides[4][7]} ${this.sides[4][8]} |\n +–––––––+–––––––+–––––––+–––––––+\n         | ${this.sides[5][0]} ${this.sides[5][1]} ${this.sides[5][2]} |\n         | ${this.sides[5][3]} ${this.sides[5][4]} ${this.sides[5][5]} |\n         | ${this.sides[5][6]} ${this.sides[5][7]} ${this.sides[5][8]} |\n         +–––––––+`}prettyPrint(){let e=this.pretty();return console.log(e),e}rotate(e,t=!1){if(e=e.toUpperCase(),this.axis.indexOf(e)>-1)return void this.rotateAxis(e,t);if(this.sideOrder.indexOf(e)<0)throw new Error("Unknown side "+e);let s={};s[e+"0"]=e+"2",s[e+"1"]=e+"5",s[e+"2"]=e+"8",s[e+"5"]=e+"7",s[e+"8"]=e+"6",s[e+"7"]=e+"3",s[e+"6"]=e+"0",s[e+"3"]=e+"1";for(let t=0;t<12;t++)s[this.adjacentFaces[e][t]]=this.adjacentFaces[e][(t+3)%12];if(t){let e={};for(let t in s)e[s[t]]=t;s=e}this.changeFaces(s)}rotateAxis(e,t=!1){let s={};if("M"===e?(s.F1="D1",s.F4="D4",s.F7="D7",s.D1="B7",s.D4="B4",s.D7="B1",s.B7="U1",s.B4="U4",s.B1="U7",s.U1="F1",s.U4="F4",s.U7="F7"):"E"===e?(s.F3="R3",s.F4="R4",s.F5="R5",s.R3="B3",s.R4="B4",s.R5="B5",s.B3="L3",s.B4="L4",s.B5="L5",s.L3="F3",s.L4="F4",s.L5="F5"):"S"===e&&(s.U3="R1",s.U4="R4",s.U5="R7",s.R1="D5",s.R4="D4",s.R7="D3",s.D3="L1",s.D4="L4",s.D5="L7",s.L1="U5",s.L4="U4",s.L7="U3"),t){let e={};for(let t in s)e[s[t]]=t;s=e}this.changeFaces(s)}changeFaces(e){let t={};for(let s in e)t[s]=this.get(s);for(let s in e)this.set(e[s],t[s])}static fromString(s){"string"==typeof s&&(s=s.split(""));let i=new t;for(let t=0;t<6;t++)for(let n=0;n<9;n++){let r=9*t+n,o=".";void 0!==s[r]&&(o=s[r]),i.sides[t][n]=new e(o,t,n)}return i}}class s{constructor(){this.moveset=["F","R","U","L","B","D","M","E","S","F'","R'","U'","L'","B'","D'","M'","E'","S'"],this.germanMovesetMap={V:"F",H:"B",L:"L",R:"R",U:"D",O:"U",v:"f",h:"b",l:"l",r:"r",u:"d",o:"u"}}validMove(e){return this.moveset.indexOf(e)>-1}plan(e,t=!1,s=!1){e=e.replace(/2'/g,"'2"),s&&(e=this.convertGermanNotation(e));let i=[];for(let s=0,n=(e=t?this.convertDoubleLayerMoves(e):e.toUpperCase()).length;s<n;s++){let t=e[s];"'"===t&&i.length>0?1===i[i.length-1].length&&(i[i.length-1]+="'"):"2"===t&&i.length>0?i.push(i[i.length-1]):this.moveset.indexOf(t)>-1?i.push(t):t.trim()&&console.log("unknown move: '"+t+"'")}return i}convertGermanNotation(e){for(let t in this.germanMovesetMap)e=e.replace(new RegExp(t,"g"),this.germanMovesetMap[t]);return e}convertDoubleLayerMoves(e){return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/([fbudlr]'?)2/g,"$1$1")).replace(/f'/g,"F'S'")).replace(/f/g,"FS")).replace(/b'/g,"B'S")).replace(/b/g,"BS'")).replace(/u'/g,"U'E")).replace(/u/g,"UE'")).replace(/d'/g,"D'E'")).replace(/d/g,"DE")).replace(/l'/g,"L'M'")).replace(/l/g,"LM")).replace(/r'/g,"R'M")).replace(/r/g,"RM'")}randomMove(){return this.moveset[Math.floor(Math.random()*this.moveset.length)]}randomMoveNoCcw(){return this.moveset[Math.floor(Math.random()*this.moveset.length*.5)]}}class i{constructor(e){this.finder=e,this.cubeFaces=[]}build(){this.createButtons(),this.createInputs(document.querySelector(".cube-side.up"),"U"),this.createInputs(document.querySelector(".cube-side.left"),"L"),this.createInputs(document.querySelector(".cube-side.front"),"F"),this.createInputs(document.querySelector(".cube-side.right"),"R"),this.createInputs(document.querySelector(".cube-side.back"),"B"),this.createInputs(document.querySelector(".cube-side.down"),"D"),this.setup3d()}clearList(){this.resultList||(this.resultList=document.querySelector("ol")),this.resultList.innerHTML=""}appendList(e){this.resultList||(this.resultList=document.querySelector("ol"));let t=document.createElement("li");t.innerText=e,this.resultList.append(t),t.scrollIntoView()}setMonospace(e){this.monospace||(this.monospace=document.querySelector(".monospace")),this.monospace.innerText=e}set3d(e){for(let t=0;t<6;t++)for(let s=0;s<9;s++){let i=e.getFace(t,s);this.cubeFaces[t][s].innerText=i.value,this.cubeFaces[t][s].setAttribute("data-color",""+i.side)}}setCounter(e){this.counter&&(this.counter.innerText="#"+e)}createButtons(){let e=document.querySelector(".buttons"),t=document.createElement("button");t.type="button",t.innerText="create",t.addEventListener("click",(()=>{this.finder.build(this.exportInput())})),null==e||e.append(t),null==e||e.append(document.createElement("br")),null==e||e.append(document.createElement("br"));let s=document.createElement("button");s.innerText="import",s.type="button",s.addEventListener("click",(()=>{this.fillInputs(window.prompt("Provide Colors","UUUUUUUUULLLLLLLLLFFFFFFFFFRRRRRRRRRBBBBBBBBBDDDDDDDDD"))})),null==e||e.append(s),null==e||e.append(" ");let i=document.createElement("button");i.innerText="export",i.type="button",i.addEventListener("click",(()=>{window.prompt("Current Colors:",this.exportInput())})),null==e||e.append(i),this.createWordlist(),this.createButtonsRotate(),this.createButtonsExecute()}createWordlist(){let e=document.querySelector(".random"),t=document.createElement("button");t.type="button",t.innerText="start random",t.addEventListener("click",(()=>{this.finder.startRandom(this.wordlist.value)})),null==e||e.append(t),null==e||e.append(" ");let s=document.createElement("button");s.type="button",s.innerText="stop random",s.addEventListener("click",(()=>{this.finder.stopRandom()})),null==e||e.append(s),this.counter=document.createElement("span"),null==e||e.append(" "),null==e||e.append(this.counter),this.wordlist=document.createElement("textarea"),null==e||e.append(this.wordlist)}createButtonsRotate(){let e=document.querySelector(".buttons-rotate"),t=["F","B","R","L","U","D","F'","B'","R'","L'","U'","D'","M","E","S","M'","E'","S'"];for(let s of t){let t=document.createElement("button");t.innerText=s,t.addEventListener("click",(e=>()=>{this.finder.rotate(e)})(s)),null==e||e.append(t)}}createButtonsExecute(){let e=document.querySelector(".execute"),t=document.createElement("textarea");null==e||e.append(t);let s=document.createElement("button");s.innerText="execute",null==e||e.append(s),null==e||e.append(document.createElement("br"));let i=document.createElement("label"),n=document.createElement("input");n.type="checkbox",n.checked=!0,i.append(n),i.append("2-layer"),null==e||e.append(i);let r=document.createElement("label"),o=document.createElement("input");o.type="checkbox",r.append(o),r.append("de"),null==e||e.append(r),s.addEventListener("click",(()=>{this.finder.executeMoves(t.value,n.checked,o.checked)}))}setup3d(){let e=document.querySelector(".cube3d-frame");if(!e)return;let t=0,s=0,i=0,n=0,r=!1;e.addEventListener("contextmenu",(t=>{i=0,n=0,e.setAttribute("style","--rotation-x: "+i+"deg; --rotation-y: "+n+"deg"),t.preventDefault()})),e.addEventListener("mousedown",(e=>{r=!0,t=e.clientX,s=e.clientY})),e.addEventListener("mouseup",(o=>{r=!1;let d=o.clientX-t,l=o.clientY-s;i+=-1*l,n+=1*d,e.setAttribute("style","--rotation-x: "+i+"deg; --rotation-y: "+n+"deg")})),e.addEventListener("mousemove",(o=>{if(r){let r=o.clientX-t,d=o.clientY-s,l=i+-1*d,a=n+1*r;e.setAttribute("style","--rotation-x: "+l+"deg; --rotation-y: "+a+"deg")}}));let o=["up","left","front","right","back","down"],d=document.createElement("div");d.classList.add("cube3d");for(let e=0;e<6;e++){this.cubeFaces[e]=[];let t=document.createElement("div");t.classList.add("face-"+o[e]),d.append(t);for(let s=0;s<9;s++){let i=document.createElement("div");i.classList.add("cube-face"),i.style.gridArea="abcdefghi"[s],this.cubeFaces[e][s]=i,t.append(i)}}e.append(d)}createInputs(e,t){for(let s=0;s<9;s++){let i=document.createElement("input");i.type="text",i.maxLength=1,i.name=t+s,i.style.gridArea="abcdefghi"[s],e.append(i)}}fillInputs(e){e&&document.querySelectorAll(".cube-side input").forEach(((t,s)=>{void 0!==e[s]&&(t.value=e[s])}))}exportInput(){let e="";return document.querySelectorAll(".cube-side input").forEach(((t,s)=>{e+=t.value||"."})),e}}window.rcw=new class{constructor(){this.wordlist=[],this.attempts=0,this.randomRunning=!1,this.planner=new s,this.ui=new i(this),this.ui.build(),this.ui.fillInputs("scinsushlmtmoneiyifateebneertstmrindescthekatdlnabitna"),this.build(this.export())}build(e){this.cube=t.fromString(e),this.ui.setMonospace(this.cube.pretty()),this.ui.set3d(this.cube)}rotate(e){this.cube&&this.planner.validMove(e)&&(this.cube.rotate(e[0],2===e.length),this.ui.setMonospace(this.cube.pretty()),this.ui.set3d(this.cube))}startRandom(e){this.cube&&(this.wordlist=e.split(",").map((e=>e.trim().toLowerCase())),this.ui.clearList(),this.attempts=0,this.randomRunning=!0,this.random())}random(){this.attempts++;let e=this.planner.randomMoveNoCcw();this.cube.rotate(e[0],e.length>1),this.check(),this.ui.setMonospace(this.cube.pretty()),this.ui.set3d(this.cube),this.ui.setCounter(this.attempts),this.randomRunning&&window.requestAnimationFrame((()=>{this.random()}))}stopRandom(){this.randomRunning=!1}executeMoves(e,t=!1,s=!1){let i=this.planner.plan(e,t,s);console.log("executing moves: "+i.join(" "));let n=()=>{i.length&&(this.rotate(i.shift()),window.requestAnimationFrame(n))};n()}check(){let e=this.cube.toString(),t=e+e,s=t.split("").reverse().join("");e=this.cube.toString(" ");for(let i of this.wordlist)i&&(t.indexOf(i)>-1&&this.ui.appendList(e+" -> "+i),s.indexOf(i)>-1&&this.ui.appendList(e+" <- "+i))}export(){return this.ui.exportInput()}import(e){this.ui.fillInputs(e)}}}();
